@startuml
' Definição de título e participantes
title Gerenciamento de Solicitação de Empréstimo

actor Bibliotecário
participant ":TelaSolicitacoes" as Tela
participant ":ControladorSolicitacoes" as Controlador
participant ":ServiceSolicitacoes" as Service
participant "s:SolicitacaoEmprestimo" as Solicitacao
participant "c:Cliente" as Cliente
participant "l:Livro" as Livro

' Início da sequência
Bibliotecário -> Tela ++ : 1: acessarAreaSolicitacoes()
Tela -> Controlador ++ : 2: listarSolicitacoes()
Controlador -> Service ++ : 3: listarSolicitacoesPendentes()
Service --> Controlador -- : 4: retorna [listaDeSolicitacoes]
Controlador --> Tela -- : 5: retorna [listaDeSolicitacoes]
Tela --> Bibliotecário : 6: exibeSolicitacoes()

Bibliotecário -> Tela ++ : 7: selecionarSolicitacao(id)
Tela -> Controlador ++ : 8: verificarSolicitacao(id)
Controlador -> Service ++ : 9: verificarStatusCliente(id)
Service -> Solicitacao ++ : 10: getCliente()
Solicitacao --> Service -- : 11: retorna [cliente]
Service -> Cliente ++ : 12: isRegular()

' Bloco de fluxo alternativo (alt/else)
alt Cliente regular
    Cliente --> Service -- : 13: retorna [true]
    Service --> Controlador -- : 14: retorna [statusRegular]
    Controlador --> Tela -- : 15: retorna [statusRegular]
    Tela --> Bibliotecário : 16: exibeStatusRegular()
    
    Bibliotecário -> Tela ++ : 17: aprovarSolicitacao()
    Tela -> Controlador ++ : 18: aprovarSolicitacao(id)
    Controlador -> Service ++ : 19: aprovarSolicitacao(id)
    
    Service -> Solicitacao ++ : 20: atualizarStatus("Aprovada")
    Solicitacao --> Service --
    Service -> Livro ++ : 21: atualizarStatus("Emprestado")
    Livro --> Service --
    Service -> Cliente ++ : 22: adicionarAoHistorico(emprestimo)
    Cliente --> Service --

    Service --> Controlador -- : 23: retorna [confirmacaoSucesso]
    Controlador --> Tela -- : 24: retorna [confirmacaoSucesso]
    Tela --> Bibliotecário : 25: exibeConfirmacaoSucesso()

else Cliente não regular
    Cliente --> Service -- : 13.1: retorna [false]
    Service -> Cliente ++ : 13.2: getPendencias()
    Cliente --> Service -- : 13.3: retorna [listaDePendencias]
    Service --> Controlador -- : 14.1: retorna [statusNaoRegular, pendencias]
    Controlador --> Tela -- : 15.1: retorna [statusNaoRegular, pendencias]
    Tela --> Bibliotecário : 16.1: exibePendencias()

    Bibliotecário -> Tela ++ : 17.1: recusarSolicitacao()
    Tela -> Controlador ++ : 18.1: recusarSolicitacao(id)
    Controlador -> Service ++ : 19.1: recusarSolicitacao(id)
    Service -> Solicitacao ++ : 20.1: atualizarStatus("Recusada")
    Solicitacao --> Service --
    
    Service --> Controlador -- : 21.1: retorna [confirmacaoRecusa]
    Controlador --> Tela -- : 22.1: retorna [confirmacaoRecusa]
    Tela --> Bibliotecário : 23.1: exibeConfirmacaoRecusa()
end

@enduml